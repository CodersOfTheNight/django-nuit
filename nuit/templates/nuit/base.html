{% load static %}
{% load compress %}
{% load nuit %}
<!doctype html>

<html class='no-js' lang='en'>

<head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>{% block title %}Home{% endblock %}{% if nuit_app_title %} - {{page_title|default:nuit_app_title}}{% else %} - {{page_title|default:'Nuit'}}{% endif %}</title>

    {% compress css %}
    <link rel='stylesheet' type='text/x-scss' href='{% static 'app.scss' %}' />
    {% endcompress %}

    {% block head %}
    {% endblock %}

    {% block css %}
    {% endblock css %}

    <script src='{% static 'js/vendor/modernizr.js' %}'></script>

</head>
<body class='{% block body_class %}{% endblock %}'>

    {% if nuit_topbar %}
    <nav class='top-bar {{nuit_topbar_classes}}' data-topbar>
        <ul class='title-area'>
            <li class='name'>
                {% if NUIT_LARGE_LOGO %}
                    <h1 class='{% if NUIT_SMALL_LOGO %}hide-for-small-only{% endif %}'><a href='{{NUIT_GLOBAL_LINK|default:'#'}}'><img src='{% static NUIT_LARGE_LOGO %}' /></a></h1>
                    {% if NUIT_SMALL_LOGO %}
                        <h1 class='show-for-small-only'><a href='{{NUIT_GLOBAL_LINK|default:'#'}}'><img src='{% static NUIT_SMALL_LOGO %}' /></a></h1>
                    {% endif %}
                {% else %}
                    <h1><a href='{{NUIT_GLOBAL_LINK|default:'#'}}'>{{NUIT_GLOBAL_TITLE|default:'Nuit'}}</a></h1>
                {% endif %}
            </li>
            <li class='toggle-topbar menu-icon'><a href='#'></a></li>
        </ul>

        <section class='top-bar-section'>

            <ul id='left-menu-drop' class='left'>
                {% if nuit_app_title %}<li class='hide-for-small-only divider'></li>
                <li class='hide-for-small-only'><a href='{{nuit_app_url|default:'/'}}'>{{nuit_app_title}}</a></li>{% endif %}

                {% block top_bar_menu %}
                {% endblock %}

                <li class='show-for-small-only divider'></li>

            </ul>
            
            <ul class='right'>
                {% if NUIT_APPLICATIONS %}
                <li class='has-dropdown'>
                    <a href='#'>Applications</a>
                    <ul class='dropdown'>
                        {% with NUIT_APPLICATIONS as applications %}
                        {% include 'nuit/includes/_application_menu.html' %}
                        {% endwith %}
                    </ul>
                </li>
                {% endif %}
            </ul>

        </section>
    </nav>
    {% endif %}

    <section role='main'>
    <div class='clearfix container'>
        {% if nuit_leftmenu %}
        <div class='sidebar on-left hide-for-small-only'>
            {% block left_menu %}{% endblock %}
        </div>
        {% endif %}
        {% if nuit_rightmenu %}
        <div class='sidebar on-right show-for-large-up'>
        {% block right_menu %}{% endblock %}
        </div>
        {% endif %}
        <div class='main'>
            <div class='row{% if nuit_collapse_content_row %} collapse{% endif %}'>
                <div class='small-12 columns'>
                    {% if nuit_rightmenu %}
                        <a href='#' data-dropdown='right-menu-drop' class='hide-for-large-up actions small secondary radius button dropdown right'><i class='fi-widget size-24'></i></a>
                        <ul id='right-menu-drop' data-dropdown-content class='f-dropdown'>
                        </ul>
                    {% endif %}

                    <div class='nuit-messages'>
                    {% if messages %}
                        {% for message in messages %}
                        <div data-alert class='alert-box {{message.tags}} {{message|message_class}}'>{{message}}<a href='#' class='close'>&times;</a></div>
                        {% endfor %}
                    {% endif %}
                    </div>

                    {% if nuit_breadcrumbs %}
                        <ul class='breadcrumbs nuit-breadcrumbs'>
                            {% if nuit_app_title %}<li><a href='{{nuit_app_url|default:'/'}}'>{{nuit_app_title}}</a></li>{% endif %}
                            {% block breadcrumbs %}
                            {% endblock %}
                        </ul>
                    {% endif %}

                    {% block content %}

                    {% endblock %}
                </div>
            </div>
        </div>
    </div>
    </section>

    <script src='{% static 'js/vendor/jquery.js' %}'></script>
    <script src='{% static 'js/vendor/jquery.cookie.js' %}'></script>
    <script src='{% static 'js/foundation.min.js' %}'></script>
    <script>

    var csrftoken = $.cookie('csrftoken');
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        crossDomain: false, // obviates need for sameOrigin test
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type)) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                xhr.setRequestHeader('Accept', 'application/json');
            }
        }
    });

    nuit = {
        add_message: function(alert_type, message) {
            alert_type = alert_type.toLowerCase()
            message_html = '<div data-alert class="alert-box ' + alert_type + '">' + message + '<a href="#" class="close">&times;</a></div>';
            var $message = $(message_html);
            $('.nuit-messages').append($message).foundation('reflow');
        }
    }

    $('.nuit-active-menu').each(function() {
        $('.menu-' + $(this).html()).addClass('active');
    });

    $(document).on('closed', '[data-reveal]', function () {
        var modal = $(this);
        modal.attr('style', '');
    });

    $('.nuit-breadcrumbs li:last-child').addClass('current');

    $('.sidebar.on-right > section').each(function() {
        $this = $(this);
        if ($this.data('reveal') == "") {
            $('#right-menu-drop').append("<li><a href='#' data-reveal-id='" + $this.attr('id') + "'>" + $this.data('link') + "</a></li>");
        } else {
            $nav = $this.find('nav');
            if ($nav.length) {
                $nav.find('ul li').each(function() {
                    $li = $(this);
                    $('#right-menu-drop').append($li.clone());
                });
            }
        }
    });

    $('.sidebar.on-left > section').each(function() {
        $this = $(this);
        $nav = $this.find('nav');
        if ($nav.length) {
            $title = $this.find('h5');
            $append_to = $('#left-menu-drop');
            if ($title.length && !$this.hasClass('main-nav')) {
                $new_li = $('<li></li>').addClass('show-for-small-only').addClass('has-dropdown')
                $new_li.append("<a href='#'>" + $title.html() + "</a>");
                $append_to.append($new_li);
                $new_ul = $("<ul class='dropdown'></ul>");
                $new_li.append($new_ul);
                $append_to = $new_ul;
            }
            $nav.find('ul li').each(function() {
                $li = $(this);
                $append_to.append($li.clone().addClass('show-for-small-only'));
            });
            $('#left-menu-drop').append("<li class='show-for-small-only divider'></li>");
        }
    });

    $('table.responsive').find('td').each(function() {
        $td = $(this);
        $td.attr('data-title', $td.closest('table').find('th').eq($td.index()).html());
    });

    $(document).foundation();

    </script>

    {% block scripts %}
    {% endblock scripts %}
    
</body>

</html>
    